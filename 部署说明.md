# ThinkPHP 服务部署端口配置说明

## 端口配置方式

### 方式一：使用环境变量（推荐）

在云平台的环境变量中设置：
- `PORT=80` - 服务监听端口
- `HOST=0.0.0.0` - 监听地址（默认 0.0.0.0 表示所有网卡）

### 方式二：使用启动脚本

#### Linux/Mac 系统
```bash
PORT=80 HOST=0.0.0.0 bash start.sh
```

#### Windows 系统
```cmd
set PORT=80
set HOST=0.0.0.0
start.bat
```

#### 直接使用 PHP 命令
```bash
php -S 0.0.0.0:80 -t public public/router.php
```

## 常见端口

- **80** - HTTP 默认端口
- **8080** - 常用替代端口
- **3000** - 开发常用端口
- **443** - HTTPS 端口

## 检查端口是否一致

1. **检查云平台配置**
   - 登录云平台控制台
   - 查看"版本配置"或"服务配置"
   - 确认端口设置为 80

2. **检查启动命令**
   - 如果使用启动脚本，确保 `PORT` 环境变量为 80
   - 如果使用 PHP 命令，确保端口参数为 80

3. **检查日志**
   - 查看 `runtime/log/` 目录下的日志文件
   - 查看云平台的"日志管理"功能

## Apache/Nginx 配置

如果使用 Apache 或 Nginx，端口在服务器配置文件中：

### Apache (httpd.conf)
```apache
Listen 80
```

### Nginx (nginx.conf)
```nginx
server {
    listen 80;
    root /path/to/public;
    index index.php;
    
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    location ~ \.php$ {
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
```

## 故障排查

1. **端口被占用**
   ```bash
   # Linux/Mac
   lsof -i :80
   netstat -an | grep 80
   
   # Windows
   netstat -ano | findstr :80
   ```

2. **防火墙规则**
   - 确保云平台安全组开放对应端口
   - 确保服务器防火墙允许端口访问

3. **查看启动日志**
   - 检查启动脚本输出
   - 查看云平台日志管理

