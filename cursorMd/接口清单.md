# 接口清单 - 快速参考

## 接口列表

| 序号 | 接口路径 | 方法 | 说明 | 是否需要Token |
|------|---------|------|------|--------------|
| 1 | `/api/auth/wechat/login` | POST | 微信登录 | ❌ |
| 2 | `/api/auth/user/update` | POST | 更新用户信息 | ✅ |
| 3 | `/api/punch/submit` | POST | 提交打卡记录 | ✅ |
| 4 | `/api/punch/records` | GET | 获取打卡记录列表 | ✅ |
| 5 | `/api/punch/statistics` | GET | 获取打卡统计数据 | ✅ |
| 6 | `/api/settings/save` | POST | 保存用户设置 | ✅ |
| 7 | `/api/settings/get` | GET | 获取用户设置 | ✅ |
| 8 | `/api/subscribe/save` | POST | 保存订阅消息授权 | ✅ |
| 9 | `/cron/send-remind` | 内部 | 发送提醒消息（定时任务） | ❌ |

---

## 请求头格式

### 需要Token的接口
```
Authorization: Bearer {token}
Content-Type: application/json
```

### 不需要Token的接口
```
Content-Type: application/json
```

---

## 快速测试命令

### 1. 微信登录
```bash
curl -X POST https://your-domain.com/api/auth/wechat/login \
  -H "Content-Type: application/json" \
  -d '{"code":"081xxxxxx"}'
```

### 2. 提交打卡
```bash
curl -X POST https://your-domain.com/api/punch/submit \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{"timestamp":1704067200000}'
```

### 3. 获取打卡记录
```bash
curl -X GET "https://your-domain.com/api/punch/records?page=1&page_size=20" \
  -H "Authorization: Bearer {token}"
```

### 4. 保存设置
```bash
curl -X POST https://your-domain.com/api/settings/save \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "enabled": 1,
    "work_start_time": "09:00",
    "work_end_time": "18:00",
    "remind_interval": 2
  }'
```

---

## 数据库表清单

1. `users` - 用户表
2. `punch_records` - 打卡记录表
3. `user_settings` - 用户设置表
4. `user_subscribes` - 订阅消息表
5. `message_logs` - 消息发送日志表（可选）

---

## 微信接口清单

1. **获取 openid**: `https://api.weixin.qq.com/sns/jscode2session`
2. **获取 access_token**: `https://api.weixin.qq.com/cgi-bin/token`
3. **发送订阅消息**: `https://api.weixin.qq.com/cgi-bin/message/subscribe/send`

---

## 开发优先级

### 第一阶段（核心功能）
1. ✅ 微信登录接口
2. ✅ 提交打卡接口
3. ✅ 获取打卡记录接口
4. ✅ 获取统计数据接口

### 第二阶段（设置功能）
5. ✅ 保存/获取用户设置接口

### 第三阶段（消息功能）
6. ✅ 保存订阅消息授权接口
7. ✅ 定时任务发送提醒消息

---

## 常见问题

### Q: Token 过期时间？
A: 2小时，过期后需要重新登录。

### Q: 打卡记录保存多久？
A: 建议永久保存，或根据业务需求设置保留期限。

### Q: 定时任务执行频率？
A: 建议每5-10分钟执行一次。

### Q: access_token 有效期？
A: 2小时，需要缓存并提前刷新。

---

**最后更新**: 2024-01-01

